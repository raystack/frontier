basic_auth_user_db: &USER_DB
  - user: user
    # password must be hashed using MD5, SHA1, or BCrypt(recommended) using htpasswd
    # Note: hashing via bcrypt do add additional ~50ms to each request
    # password: $apr1$RfxoV6GP$.GsGgD580H5FOuUfTzKZh0 # password via md5
    password: $2y$10$F814ZwQPt8VHYIayIqeEReSeZz8dDCNX93/rKI82SqJu9I2Bn6Hau # password via bcrypt
    capabilities: [ "ping:foo", "do:bar" ]
rules:
  - frontend:
      url: "sample/"
      methods: [ "GET", "POST" ]
    backend:
      url: "http://localhost:3030/"
#    middlewares:
#      - name: authz
#        config:
#          action: abc
#          attributes:
#            project:
#              key: data.project
#              type: json_payload
    hooks:
      - name: authz
        config:
          action: authz_action
          attributes:
            project:
              key: host.ip
              type: json_payload
#            group1:
#              key: group
#              type: json_payload
#              source: request
            group2:
              key: host.hostname
              type: json_payload

  - frontend:
      url: "sample-auth/"
      methods: [ "GET", "POST" ]
    backend:
      url: "http://localhost:8080/"
    middlewares:
      - name: prefix
        config:
          strip: "/sample-auth"

      - name: basic_auth
        config:
          users: *USER_DB
  - frontend:
      url: "sample-authz/"
      methods: [ "POST" ]
    backend:
      url: "http://localhost:8080/"
    middlewares:
      - name: prefix
        config:
          strip: "/sample-authz"

      - name: basic_auth
        config:
          users: *USER_DB
          scope:
            action: "ping:{{.project}}"
            attributes:
              project:
                type: json_payload
                key: project